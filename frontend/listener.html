<!doctype html>
<html>
  <head>
    <title>Listener</title>
  </head>
  <body>
    <audio id="audio" autoplay controls></audio>
    <script>
      const audio = document.getElementById("audio");
      const mediaSource = new MediaSource();
      audio.src = URL.createObjectURL(mediaSource);

      mediaSource.addEventListener("sourceopen", () => {
        const mime = "audio/webm; codecs=opus";
        const sourceBuffer = mediaSource.addSourceBuffer(mime);

        const stream = new ReadableStream({
          start(controller) {
            const reader = stream.getReader();

            fetch("https://test.com/english").then((res) => {
              const reader = res.body.getReader();

              function read() {
                reader.read().then(({ done, value }) => {
                  if (done) return;
                  sourceBuffer.appendBuffer(value);
                  read();
                });
              }

              read();
            });
          },
        });
      });
    </script>
  </body>
</html>
